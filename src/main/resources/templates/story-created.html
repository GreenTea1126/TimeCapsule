<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>TimeCapsule-스토리 생성</title>
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/story-created.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div th:replace="~{fragments/sidebar :: sidebar}"></div>

<main>
    <h1>당신만의 특별한 스토리</h1>
    <form th:action="@{/stories}" method="post" id="createForm" enctype="multipart/form-data">
        <div class="form-group">
            <label>커뮤니티 게시&nbsp;&nbsp;&nbsp;</label>
            <label class="switch">
                <input type="checkbox" id="communityToggle" name="isShared" value=true >
                <span class="slider"></span>
            </label>
            <input type="hidden" name="_isShared" id="hiddenIsShared" value=false>
        </div>
        <div class="share-list">
            <span class="image-upload-container">
                <input type="file" id="imageUpload" name="images" accept="image/*" multiple class="hidden-file-input">
                <button type="button" class="upload-btn" id="uploadBtn"><img src="/images/ImageFileAdd.png"
                                                                             alt="이미지 업로드">이미지 업로드
                </button>
            </span>
            <span>
                <span class="create-story-option">공유자</span>
                <span class="create-story-option tag-input-container"><input type="text" id="sharedList" class="tag-input"></span>
                <span class="create-story-option"><button id="shareSearchButton">검색</button></span>
            </span>
        </div>
        <input type="text" id="title" name="title" placeholder="제목을 입력해 주세요.">
        <div class="story-container">
            <div id="content">Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                A commodi cupiditate dicta eligendi facere, inventore, magni modi nam necessitatibus ne
                mo neque nobis quas qui temporibus tenetur vitae voluptatibus! Deserunt, dolorem!
            </div>
            <input type="hidden" id="contentInput" name="content">
        </div>
        <div class="story-container-buttons">
            <span><button type="submit" id="save" class="create-story-button">스토리 저장</button></span>
            <span><button id="edit" class="create-story-button">스토리 수정</button></span>
            <span><button id="cancel" class="create-story-button">스토리 취소</button></span>
        </div>
        <input type="hidden" name="userId" id="userId">
    </form>
    <div id="shareModal">
        <div id="shareModalContent">
            <div id="keyword">키워드</div>
            <div id="searchedList">
<!--                <div class="searchedUser"></div>-->
            </div>
            <div id="modalSharedList"></div>
        </div>
        <button id="share" class="create-story-button">공유</button>
    </div>
    <div id="storyModal">
        <div id="storyModalContent"></div>
        <button id="storyModalButton" class="create-story-button">확인</button>
    </div>
</main>

<div th:replace="~{fragments/footer :: footer}"></div>
<script th:src="@{/js/story-modal.js}"></script>
<script th:src="@{/js/image-upload.js}"></script>
<script type="text/javascript" th:src="@{/js/auth.js}"></script>
<!--<script th:src="@{/js/story.js}"></script>-->
<script>
    document.getElementById('createForm').addEventListener('submit', function() {
        // div의 내용을 숨겨진 필드에 복사
        document.getElementById('contentInput').value = document.getElementById('content').innerText;

        const searchedUsers = document.getElementsByClassName('searchedUser');
        for (let i = 0; i < searchedUsers.length; i++) {
           searchedUsers[i].value = searchedUsers[i].placeholder;
            console.log(searchedUsers.value);
        }
    });

    document.getElementById('createForm').addEventListener('submit', function(event) {
        event.preventDefault(); // 폼 제출을 막음
    });

    // 파일 업로드 필드가 비어있는지 확인
    const fileInput = document.getElementById('imageUpload');
    if (fileInput.files.length === 0) {
        // 파일이 선택되지 않았다면 해당 입력 필드를 제거 또는 처리
        fileInput.remove();
    }

    const communityToggle = document.getElementById('communityToggle');

    // 체크박스 상태 변경 시 true 또는 false 값을 전송하도록 설정
    communityToggle.addEventListener('change', function() {
        if (communityToggle.checked) {
            this.value = true;
        } else {
            this.value = false;
        }
    });
</script>
</body>
</html>